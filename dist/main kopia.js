!function(t){var i={};function e(s){if(i[s])return i[s].exports;var h=i[s]={i:s,l:!1,exports:{}};return t[s].call(h.exports,h,h.exports,e),h.l=!0,h.exports}e.m=t,e.c=i,e.d=function(t,i,s){e.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:s})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,i){if(1&i&&(t=e(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(e.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var h in t)e.d(s,h,function(i){return t[i]}.bind(null,h));return s},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},e.p="",e(e.s=0)}([function(t,i,e){"use strict";function s(t,i,e){const s=e?document.getElementById(e):document.createElement("canvas");return s.width=t,s.height=i,s.ctx=s.getContext("2d"),s}e.r(i);const h=(t,i)=>{const e=i-1;return{x:e%t.cols*t.tw,y:Math.floor(e/t.cols)*t.th,w:t.tw,h:t.th}},a=1e3/60,r=1/60;class n{constructor(t){this.raf=null,this.setState(t)}setState(t){this.state=t}start(){this.now=performance.now(),this.last=this.now,this.elapsed=0,this.accumulator=0,requestAnimationFrame(this.update.bind(this))}stop(){cancelAnimationFrame(this.raf)}update(){if(this.raf=requestAnimationFrame(this.update.bind(this)),this.now=performance.now(),this.elapsed=this.now-this.last,this.last=this.now,!(this.elapsed>1e3)){for(this.state.prepare(),this.accumulator+=this.elapsed;this.accumulator>=a;)this.state.update(r),this.accumulator-=a;this.state.render()}}}const l={ground:[1,2,3],grass:[5,6],tree:[7,8],road:50,attack:84,defend:87,spell:71,player:97,barbarian:98,rogue:99,assassin:100,fellow1:103,fellow2:104,snake:105,bat:106,bandit1:107,bandit2:108,orc:109,ogre:110,dog:111,horse:112,skeleton:113,ghost:114,devil:115,crab:116,fly:117,scarab:118,boss:119,king:120},c={tower:{width:9,height:15,data:[0,9,13,13,13,13,13,9,0,0,17,11,35,35,35,11,17,0,0,17,1,25,28,27,1,17,0,0,17,1,33,33,33,1,17,0,0,17,1,25,28,27,1,17,0,0,17,1,33,33,33,1,17,0,0,10,13,13,13,13,13,10,0,0,17,11,17,20,17,11,17,0,51,42,17,49,20,49,17,42,52,53,26,20,57,17,57,17,26,53,53,26,17,20,17,20,21,26,53,53,26,20,17,49,20,20,26,53,53,43,20,17,57,20,17,43,53,53,26,20,20,57,17,20,41,53,59,61,61,61,45,61,61,61,60]},inn:{width:17,height:17,data:[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,1,1,1,1,1,2,1,1,17,19,17,17,17,19,17,1,1,1,1,1,1,1,1,7,1,17,1,46,47,48,1,17,2,1,1,1,1,1,7,1,1,1,17,1,1,1,1,101,17,1,1,1,1,2,1,1,1,17,17,17,17,17,17,17,29,17,1,1,1,17,17,17,17,17,17,1,38,1,56,1,1,58,17,1,7,1,19,1,1,30,39,17,1,1,1,1,1,102,1,17,7,1,7,17,32,1,1,58,29,1,31,31,31,1,1,1,17,2,1,1,17,1,1,37,1,17,1,14,15,16,1,1,1,17,19,17,1,17,17,17,17,17,17,1,31,31,31,1,1,31,22,31,17,1,19,1,1,30,39,17,1,1,1,1,1,1,31,23,31,17,1,17,32,1,1,58,29,1,1,1,1,1,1,31,24,31,17,1,17,1,1,37,1,17,1,1,1,1,1,1,1,1,1,17,2,17,17,17,17,17,17,36,1,1,1,58,1,1,1,36,17,1,1,2,1,1,1,17,17,17,19,17,29,17,19,17,17,17,1,7,1,2,1,1,1,2,1,1,1,50,40,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,50,1,1,1,2,1,1]},graves:{width:5,height:5,data:[66,1,68,1,65,3,3,3,3,3,65,1,3,1,66,1,1,3,69,1,67,1,3,1,67]},fort:{width:4,height:3,data:[0,13,0,0,13,18,17,0,17,17,17,44]},house:{width:5,height:3,data:[0,34,34,34,0,34,21,17,21,34,17,21,29,21,17]},castle:{width:9,height:10,data:[51,61,61,61,61,61,61,61,52,53,9,13,13,13,13,13,9,53,53,17,11,35,35,35,11,17,53,53,17,1,17,29,17,1,17,53,53,17,1,1,50,1,1,17,53,53,17,1,58,50,1,1,17,53,53,17,1,1,50,58,1,17,53,53,10,13,13,13,13,13,10,53,53,17,11,17,49,17,11,17,53,59,61,61,61,45,61,61,61,60]},castleroom:{width:17,height:15,data:[17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,26,43,26,26,63,26,26,42,26,26,64,26,26,43,26,17,17,26,1,1,1,1,1,1,1,1,1,1,1,1,1,26,17,17,26,1,37,4,4,62,4,4,4,62,4,4,37,1,26,17,17,26,1,1,1,1,1,1,1,1,1,1,1,4,1,26,17,17,26,1,4,4,4,4,4,4,4,4,4,1,4,1,26,17,17,26,1,4,1,1,1,1,1,1,1,4,1,4,1,26,17,17,26,1,4,1,4,4,4,4,4,1,4,1,4,1,26,17,17,26,1,4,1,4,1,1,1,1,1,4,1,4,1,26,17,17,26,1,4,1,4,4,4,4,4,4,4,1,4,1,26,17,17,26,1,4,1,1,1,1,1,1,1,1,1,4,1,26,17,17,26,1,37,4,4,4,4,4,4,4,4,4,37,1,26,17,17,26,55,1,1,1,1,1,1,1,1,1,1,1,55,26,17,17,17,17,13,17,13,17,13,13,13,17,13,17,13,17,17,17,17,17,17,17,17,17,17,17,29,17,17,17,17,17,17,17,17]},struct1:{width:2,height:1,data:[17,44]},struct2:{width:2,height:1,data:[17,55]},struct3:{width:2,height:1,data:[12,17]},struct4:{width:1,height:1,data:[12]},struct5:{width:1,height:1,data:[55]},struct6:{width:1,height:1,data:[44]}},o=33;class p{constructor(t){this.image=null,this.width=0,this.height=0,this.tileset=t,this.data=[],this.objects=[],this.sprites=[]}tower(){this.setSize(3),this.fillForest(),this.fillRoad(70),this.putObject(12,65,"tower"),this.putObject(24,63,"graves"),this.putObject(24,80,"house"),this.putStruct(9,82),this.putStruct(7,84),this.putStruct(10,83),this.putStruct(21,86),this.fillObjects(),this.putSprite(16,79,"player"),this.draw()}inn(){this.setSize(),this.fill(),this.putObject(8,8,"inn"),this.fillObjects(),this.putSprite(18,20,"player"),this.putSprite(15,15,"barbarian"),this.putSprite(17,15,"rogue"),this.putSprite(16,17,"assassin"),this.draw()}forest(){this.setSize(7),this.fillForest(),this.fillRoad(33),this.putObject(12,24,"castle"),this.putObject(21,67,"graves"),this.putObject(20,35,"house"),this.putObject(9,36,"fort"),this.putStruct(8,41),this.putStruct(9,43),this.putStruct(27,38),this.putStruct(25,41),this.fillObjects(),this.putSprite(15,28,"bat"),this.putSprite(17,29,"bat"),this.putSprite(16,36,"ogre"),this.putSprite(15,37,"orc"),this.putSprite(17,37,"orc"),this.putSprite(17,36,"snake"),this.putSprite(14,35,"snake"),this.putSprite(16,211,"player"),this.putSprite(15,210,"barbarian"),this.putSprite(16,210,"rogue"),this.putSprite(17,210,"assassin"),this.draw()}castleroom(){this.setSize(),this.fill(),this.putObject(8,9,"castleroom"),this.fillObjects(),this.putSprite(16,21,"player"),this.putSprite(15,20,"barbarian"),this.putSprite(16,20,"rogue"),this.putSprite(17,20,"assassin"),this.putSprite(16,12,"boss"),this.putSprite(14,16,"crab"),this.putSprite(16,15,"fly"),this.putSprite(18,16,"scarab"),this.draw()}setSize(t=1){this.width=o,this.height=o*t}fill(t=1){for(let i=0;i<this.width;i++){this.data[i]=[];for(let e=0;e<this.height;e++)this.data[i][e]=t}}fillForest(){const t=new Array(3).fill(l.ground[0]).concat(l.ground[1],l.tree,l.tree);for(let i=0;i<this.width;i++){this.data[i]=[];for(let e=0;e<this.height;e++)this.data[i][e]=d(t)}}fillRoad(t=0){const i=l.ground[0],e=l.ground[1],s=new Array(10).fill(i).concat(e),h=new Array(4).fill(i).concat(new Array(4).fill(e)),a=[i,i,i,e,e].concat(l.tree),r=new Array(2).fill(s).concat(new Array(2).fill(h)).concat([a,a,a]),n=Math.floor(this.width/2);for(let i=t;i<this.height;i++){this.data[n][i]=l.road;for(let t=0;t<r.length;t++)this.data[n-t-1][i]=d(r[t]),this.data[n+t+1][i]=d(r[t])}}fillObjects(){for(let t in this.objects){let i=this.objects[t].x,e=this.objects[t].y,s=this.objects[t].type,h=c[s];for(let t=0;t<h.width;t++)for(let s=0;s<h.height;s++){let a=h.data[t+s*h.width];a>0&&(this.data[t+i][s+e]=a)}}}putObject(t,i,e){this.objects.push({x:t,y:i,type:e})}putStruct(t,i){this.putObject(t,i,"struct"+(1+Math.floor(6*Math.random())))}putSprite(t,i,e){this.sprites.push({x:t,y:i,type:e})}draw(){const t=this.width,i=this.height,e=this.tileset;this.image=s(t*e.tw,i*e.th);for(let s=0;s<t;s++)for(let t=0;t<i;t++){const i=h(e,this.data[s][t]);this.image.ctx.drawImage(e.img,i.x,i.y,i.w,i.h,s*i.w,t*i.h,i.w,i.h)}}drawSprites(){let t=this.tileset;for(let i in this.sprites){let e=this.sprites[i],s=h(l[e.type]);this.image.ctx.drawImage(t.img,s.x,s.y,s.w,s.h,e.x*s.w,e.y*s.h,s.w,s.h)}}}function d(t){return t[Math.floor(Math.random()*t.length)]}const u=32,g=12;class f{constructor(t,i){this.game=t,this.txt=i,this.ctxt=[],this.fnt=this.game.fnt,this.canvas=s(u*this.fnt.size,g*this.fnt.size*2),this.time=0,this.line=0,this.linewait=1,this.screen=0}update(t){this.time+=t,this.time>=this.linewait&&(this.txt[this.screen][this.line][0]&&this.ctxt.push(this.txt[this.screen][this.line][0]),this.time=0,this.linewait=this.txt[this.screen][this.line][1],this.line+=1)}render(){for(let t in this.ctxt){const i=Math.floor((u-this.ctxt[t].length)/2)*this.fnt.size;this.fnt.text(this.canvas.ctx,i,t*this.fnt.size*2,this.ctxt[t])}}}const m=t=>t<.5?2*t*t:(4-2*t)*t-1,w=[[["SOUTHERN TOWER OF SPELLS",0],["is known for powerful mages",6],[" ",0],["After years of education",0],["YOUNG MAGE",4],[" ",0],["GOES BACK",2],["to his village"]]];class y{constructor(t){this.game=t,this.inter=new f(this.game,w),this.map=new p(this.game.tls),this.map.tower(),this.overlay=s(this.map.image.width,this.map.image.height),this.start={x:16*this.map.sprites[0].x-8,y:192},this.end={x:16*this.map.sprites[0].x-8,y:16*(this.map.sprites[0].y-4)-8},this.time=0,this.endtime=8,this.distance=this.end.y-this.start.y,this.pos={},this.pos.x=this.start.x,this.pos.y=this.start.y,this.width=528,this.height=528,this.halfWidth=this.width/2,this.halfHeight=this.height/2,this.scale=2,this.player={x:16*this.map.sprites[0].x,y:16*this.map.sprites[0].y},this.playerTile=h(this.game.tls,l.player),this.walks=!1}prepare(){}update(t){this.time+=t,this.inter.update(t),this.time<=8&&(this.pos.y=this.start.y+Math.floor(m(this.time/this.endtime)*this.distance)),this.time>=14&&(this.player.y+=20*t),this.time>=20&&this.game.changeStateInn()}render(){const t=this.game.screenA.scale;this.inter.render(),this.game.screenB.ctx.fillStyle="#091431",this.game.screenB.ctx.fillRect(0,0,this.game.screenB.width,this.game.screenB.height);const i=this.inter.canvas.width,e=this.inter.canvas.height,s=i*t,h=e*t,a=(this.game.screenB.width-s)/2,r=(this.game.screenB.height-h)/2;this.game.screenB.ctx.drawImage(this.inter.canvas,0,0,i,e,a,r,s,h);const n=this.pos.x-this.halfWidth,l=this.pos.y-this.halfHeight,c=this.width,o=this.height,p=c*t,d=o*t,u=(this.game.screenA.width-p)/2,g=(this.game.screenA.height-d)/2;this.game.screenA.ctx.drawImage(this.map.image,n,l,c,o,u,g,p,d),this.overlay.ctx.clearRect(0,0,this.map.image.width,this.map.image.height),this.overlay.ctx.drawImage(this.game.tls.img,this.playerTile.x,this.playerTile.y,this.playerTile.w,this.playerTile.h,Math.floor(this.player.x),Math.floor(this.player.y),this.playerTile.w,this.playerTile.h),this.game.screenA.ctx.drawImage(this.overlay,n,l,c,o,u,g,p,d),this.game.render()}}class x{constructor(t){this.game=t,this.map=new p(this.game.tls),this.map.inn(),this.map.drawSprites(),this.pos={x:256,y:272},this.width=528,this.height=528,this.halfWidth=this.width/2,this.halfHeight=this.height/2}prepare(){}update(t){}render(){const t=this.game.screenA.scale;this.game.screenB.ctx.fillStyle="#091431",this.game.screenB.ctx.fillRect(0,0,this.game.screenB.width,this.game.screenB.height);const i=this.pos.x-this.halfWidth,e=this.pos.y-this.halfHeight,s=this.width,h=this.height,a=s*t,r=h*t,n=(this.game.screenA.width-a)/2,l=(this.game.screenA.height-r)/2;this.game.screenA.ctx.drawImage(this.map.image,i,e,s,h,n,l,a,r),this.game.render()}}let S=0;function b(){(S+=1)>=2&&(A.state=new y(A),A.loop=new n(A.state),A.loop.start())}const A={};A.imgFont=new Image,A.fnt=new class{constructor(t,i,e,s){this.image=t,this.size=i,this.columns=e,this.start=s}text(t,i,e,s){let h=i,a=e;for(let i in s){const e=s.charCodeAt(i)-this.start,r=e%this.columns*this.size,n=Math.floor(e/this.columns)*this.size;t.drawImage(this.image,r,n,this.size,this.size,h,a,this.size,this.size),h+=this.size}}}(A.imgFont,8,16,48),A.imgFont.onload=b,A.imgFont.src="./img/font.png",A.img=new Image,A.tls=((t,i,e,s)=>({img:t,tw:i,th:e,cols:s}))(A.img,16,16,8),A.img.onload=b,A.img.src="./img/tileset.png";const j=528,O=528;function B(t,i){const e=Math.ceil(t.width/i.width),s=Math.ceil(t.height/i.height);return Math.min(e,s)}function v(){A.screen=s(window.innerWidth,window.innerHeight,"screen"),A.halfs=function(t,i){const e=t<=i,s=e?t:Math.floor(t/2),h=e?Math.floor(i/2):i;return{A:{x:0,y:0,width:s,height:h},B:{x:e?0:t-s,y:e?i-h:0,width:s,height:h}}}(A.screen.width,A.screen.height),A.screenA=s(A.halfs.A.width,A.halfs.A.height),A.screenB=s(A.halfs.B.width,A.halfs.B.height),A.screenA.scale=B(A.halfs.A,{width:j,height:O}),A.screenB.scale=B(A.halfs.B,{width:j,height:O}),A.screenA.ctx.fillStyle="red",A.screenA.ctx.fillRect(0,0,A.halfs.A.width,A.halfs.A.height),A.screenB.ctx.fillStyle="blue",A.screenB.ctx.fillRect(0,0,A.halfs.B.width,A.halfs.B.height)}window.addEventListener("resize",v,!1),v(),A.render=function(){this.screen.ctx.drawImage(this.screenA,this.halfs.A.x,this.halfs.A.y),this.screen.ctx.drawImage(this.screenB,this.halfs.B.x,this.halfs.B.y)},A.changeStateInn=function(){this.state=new x(this),this.loop.setState(this.state)}}]);