!function(t){var e={};function s(i){if(e[i])return e[i].exports;var h=e[i]={i:i,l:!1,exports:{}};return t[i].call(h.exports,h,h.exports,s),h.l=!0,h.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var h in t)s.d(i,h,function(e){return t[e]}.bind(null,h));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=0)}([function(t,e,s){"use strict";function i(t,e,s){const i=s?document.getElementById(s):document.createElement("canvas");return i.width=t,i.height=e,i.ctx=i.getContext("2d"),i}s.r(e);const h=(t,e)=>({x:t,y:e}),n=t=>h(t.x,t.y),a=(t,e)=>h(t.x+e.x,t.y+e.y),r=(t,e)=>a(t,o(e,-1)),c=(t,e)=>h(t.x*e.x,t.y*e.y),o=(t,e)=>h(t.x*e,t.y*e),l=t=>m(t,t)**.5,d=(t,e)=>l(r(t,e)),m=(t,e)=>t.x*e.x+t.y*e.y,f=(t,e)=>h(t%e,Math.floor(t/e)),g=(t,e,s,i)=>{const n=((t,e)=>c(f(e-1,t.cols),h(t.tw,t.th)))(e,i);t.ctx.drawImage(e.img,n.x,n.y,e.tw,e.th,s.x,s.y,e.tw,e.th)},u=t=>t[(t=>Math.floor(Math.random()*t))(t.length)],w=(t,e,s=[])=>({w:t,h:e,data:s}),p=(t,e,s)=>c(f(s,t.w),h(e.tw,e.th)),x=(t,e)=>{t.data=new Array(t.w*t.h).fill(e)},y=(t,e,s)=>{t.data[((t,e)=>t.x+t.y*e)(e,t.w)]=s},A=(t,e,s)=>{for(let i in s.data)s.data[i]>0&&y(t,a(e,f(i,s.w)),s.data[i])},B=(t,e)=>{const s=i(t.w*e.tw,t.h*e.th);for(let i in t.data)g(s,e,p(t,e,i),t.data[i]);return s},v={tower:w(9,15,[0,9,13,13,13,13,13,9,0,0,17,11,35,35,35,11,17,0,0,17,1,25,28,27,1,17,0,0,17,1,33,33,33,1,17,0,0,17,1,25,28,27,1,17,0,0,17,1,33,33,33,1,17,0,0,10,13,13,13,13,13,10,0,0,17,11,17,20,17,11,17,0,51,42,17,49,20,49,17,42,52,53,26,20,57,17,57,17,26,53,53,26,17,20,17,20,21,26,53,53,26,20,17,49,20,20,26,53,53,43,20,17,57,20,17,43,53,53,26,20,20,57,17,20,41,53,59,61,61,61,45,61,61,61,60]),inn:w(17,17,[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,1,1,1,1,1,2,1,1,17,19,17,17,17,19,17,1,1,1,1,1,1,1,1,7,1,17,1,46,47,48,1,17,2,1,1,1,1,1,7,1,1,1,17,1,1,1,1,101,17,1,1,1,1,2,1,1,1,17,17,17,17,17,17,17,29,17,1,1,1,17,17,17,17,17,17,1,38,1,56,1,1,58,17,1,7,1,19,1,1,30,39,17,1,1,1,1,1,102,1,17,7,1,7,17,32,1,1,58,29,1,31,31,31,1,1,1,17,2,1,1,17,1,1,37,1,17,1,14,15,16,1,1,1,17,19,17,1,17,17,17,17,17,17,1,31,31,31,1,1,31,22,31,17,1,19,1,1,30,39,17,1,1,1,1,1,1,31,23,31,17,1,17,32,1,1,58,29,1,1,1,1,1,1,31,24,31,17,1,17,1,1,37,1,17,1,1,1,1,1,1,1,1,1,17,2,17,17,17,17,17,17,36,1,1,1,58,1,1,1,36,17,1,1,2,1,1,1,17,17,17,19,17,29,17,19,17,17,17,1,7,1,2,1,1,1,2,1,1,1,50,40,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,50,1,1,1,2,1,1]),graves:w(5,5,[66,1,68,1,65,3,3,3,3,3,65,1,3,1,66,1,1,3,69,1,67,1,3,1,67]),fort:w(4,3,[0,13,0,0,13,18,17,0,17,17,17,44]),house:w(5,3,[0,34,34,34,0,34,21,17,21,34,17,21,29,21,17]),castle:w(9,10,[51,61,61,61,61,61,61,61,52,53,9,13,13,13,13,13,9,53,53,17,11,35,35,35,11,17,53,53,17,1,17,29,17,1,17,53,53,17,1,1,50,1,1,17,53,53,17,1,58,50,1,1,17,53,53,17,1,1,50,58,1,17,53,53,10,13,13,13,13,13,10,53,53,17,11,17,49,17,11,17,53,59,61,61,61,45,61,61,61,60]),castleroom:w(17,15,[17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,26,43,26,26,63,26,26,42,26,26,64,26,26,43,26,17,17,26,1,1,1,1,1,1,1,1,1,1,1,1,1,26,17,17,26,1,37,4,4,62,4,4,4,62,4,4,37,1,26,17,17,26,1,1,1,1,1,1,1,1,1,1,1,4,1,26,17,17,26,1,4,4,4,4,4,4,4,4,4,1,4,1,26,17,17,26,1,4,1,1,1,1,1,1,1,4,1,4,1,26,17,17,26,1,4,1,4,4,4,4,4,1,4,1,4,1,26,17,17,26,1,4,1,4,1,1,1,1,1,4,1,4,1,26,17,17,26,1,4,1,4,4,4,4,4,4,4,1,4,1,26,17,17,26,1,4,1,1,1,1,1,1,1,1,1,4,1,26,17,17,26,1,37,4,4,4,4,4,4,4,4,4,37,1,26,17,17,26,55,1,1,1,1,1,1,1,1,1,1,1,55,26,17,17,17,17,13,17,13,17,13,13,13,17,13,17,13,17,17,17,17,17,17,17,17,17,17,17,29,17,17,17,17,17,17,17,17]),struct1:w(2,1,[17,44]),struct2:w(2,1,[17,55]),struct3:w(2,1,[12,17]),struct4:w(1,1,[12]),struct5:w(1,1,[55]),struct6:w(1,1,[44])},S=[v.struct1,v.struct2,v.struct3,v.struct4,v.struct5,v.struct6],M=[1,1,1,2,7,7],b=new Array(10).fill(1).concat(2),z=new Array(4).fill(1).concat(new Array(4).fill(2)),I=new Array(2).fill(b).concat(new Array(2).fill(z)).concat([M,M,M]),O=t=>{((t,e)=>{for(let s in t.data)t.data[s]=u(e)})(t,M)},E=(t,e=0)=>{const s=Math.floor(t.w/2);for(let i=e;i<t.h;i++){y(t,h(s,i),50);for(let e=0;e<I.length;e++)y(t,h(s-e-1,i),u(I[e])),y(t,h(s+e+1,i),u(I[e]))}},F=()=>{const t=w(33,99);x(t,1),O(t),E(t,70);const e=[[12,65,v.tower],[24,63,v.graves],[24,80,v.house],[9,82,u(S)],[7,84,u(S)],[10,83,u(S)],[21,86,u(S)]];for(let s in e)A(t,h(e[s][0],e[s][1]),e[s][2]);return t},j=()=>{const t=w(33,33);return x(t,1),A(t,h(8,8),v.inn),t},R=1e3/60,P=1/60;class _{constructor(t){this.raf=null,this.setState(t)}setState(t){this.state=t}start(){this.now=performance.now(),this.last=this.now,this.elapsed=0,this.accumulator=0,requestAnimationFrame(this.update.bind(this))}stop(){cancelAnimationFrame(this.raf)}update(){if(this.raf=requestAnimationFrame(this.update.bind(this)),this.now=performance.now(),this.elapsed=this.now-this.last,this.last=this.now,!(this.elapsed>1e3)){for(this.state.prepare(),this.accumulator+=this.elapsed;this.accumulator>=R;)this.state.update(P),this.accumulator-=R;this.state.render()}}}const H=32,T=12;class W{constructor(t,e){this.game=t,this.txt=e,this.ctxt=[],this.fnt=this.game.fnt,this.canvas=i(H*this.fnt.size,T*this.fnt.size*2),this.time=0,this.line=0,this.linewait=1,this.screen=0}update(t){this.time+=t,this.time>=this.linewait&&(this.txt[this.screen][this.line][0]&&this.ctxt.push(this.txt[this.screen][this.line][0]),this.time=0,this.linewait=this.txt[this.screen][this.line][1],this.line+=1)}render(){for(let t in this.ctxt){const e=Math.floor((H-this.ctxt[t].length)/2)*this.fnt.size;this.fnt.text(this.canvas.ctx,e,t*this.fnt.size*2,this.ctxt[t])}}}const C=t=>t<.5?2*t*t:(4-2*t)*t-1,G=[[["SOUTHERN TOWER OF SPELLS",0],["is known for powerful mages",6],[" ",0],["After years of education",0],["YOUNG MAGE",4],[" ",0],["GOES BACK",2],["to his village"]]];class L{constructor(t){this.game=t,this.inter=new W(this.game,G),this.map=F(),this.map.img=B(this.map,this.game.tls),this.scrA=i(this.map.img.width,this.map.img.height);const e=this.scrA.width/2;this.start=h(e,192),this.end=h(e,this.scrA.height-384),this.camA=n(this.start),this.time=0,this.endtime=8,this.distance=d(this.start,this.end),this.player=h(256,1264)}prepare(){}update(t){this.time+=t,this.inter.update(t),this.time<=8&&(this.camA.y=this.start.y+Math.floor(C(this.time/this.endtime)*this.distance)),this.time>=14&&(this.player.y+=20*t),this.time>=20&&this.game.changeStateInn()}render(){const t=this.game.screenA.scale;this.inter.render(),this.game.screenB.ctx.fillStyle="#091431",this.game.screenB.ctx.fillRect(0,0,this.game.screenB.width,this.game.screenB.height);const e=this.inter.canvas.width,s=this.inter.canvas.height,i=e*t,h=s*t,n=(this.game.screenB.width-i)/2,a=(this.game.screenB.height-h)/2;this.game.screenB.ctx.drawImage(this.inter.canvas,0,0,e,s,n,a,i,h),this.scrA.ctx.drawImage(this.map.img,0,0),g(this.scrA,this.game.tls,this.player,97),this.game.render()}}class q{constructor(t){this.game=t,this.map=j(),this.map.image=B(this.map,this.game.tls),this.pos={x:256,y:272},this.width=528,this.height=528,this.halfWidth=this.width/2,this.halfHeight=this.height/2}prepare(){}update(t){}render(){const t=this.game.screenA.scale;this.game.screenB.ctx.fillStyle="#091431",this.game.screenB.ctx.fillRect(0,0,this.game.screenB.width,this.game.screenB.height);const e=this.pos.x-this.halfWidth,s=this.pos.y-this.halfHeight,i=this.width,h=this.height,n=i*t,a=h*t,r=(this.game.screenA.width-n)/2,c=(this.game.screenA.height-a)/2;this.game.screenA.ctx.drawImage(this.map.image,e,s,i,h,r,c,n,a),this.game.render()}}let N=0;function U(){(N+=1)>=2&&(k.state=new L(k),k.loop=new _(k.state),k.loop.start())}const k={};k.imgFont=new Image,k.fnt=new class{constructor(t,e,s,i){this.image=t,this.size=e,this.columns=s,this.start=i}text(t,e,s,i){let h=e,n=s;for(let e in i){const s=i.charCodeAt(e)-this.start,a=s%this.columns*this.size,r=Math.floor(s/this.columns)*this.size;t.drawImage(this.image,a,r,this.size,this.size,h,n,this.size,this.size),h+=this.size}}}(k.imgFont,8,16,48),k.imgFont.onload=U,k.imgFont.src="./img/font.png",k.img=new Image,k.tls=((t,e,s,i)=>({img:t,tw:e,th:s,cols:i}))(k.img,16,16,8),k.img.onload=U,k.img.src="./img/tileset.png";const K=33*k.tls.tw,Y=33*k.tls.th;function D(t,e){const s=Math.ceil(t.width/e.width),i=Math.ceil(t.height/e.height);return Math.min(s,i)}function J(){k.screen=i(window.innerWidth,window.innerHeight,"screen"),k.halfs=function(t,e){const s=t<=e,i=s?t:Math.floor(t/2),h=s?Math.floor(e/2):e;return{A:{x:0,y:0,width:i,height:h},B:{x:s?0:t-i,y:s?e-h:0,width:i,height:h}}}(k.screen.width,k.screen.height),k.screenA=i(k.halfs.A.width,k.halfs.A.height),k.screenB=i(k.halfs.B.width,k.halfs.B.height),k.screenA.scale=D(k.halfs.A,{width:K,height:Y}),k.screenB.scale=D(k.halfs.B,{width:K,height:Y}),k.screenA.ctx.fillStyle="#472d3c",k.screenA.ctx.fillRect(0,0,k.halfs.A.width,k.halfs.A.height),k.screenB.ctx.fillStyle="#472d3c",k.screenB.ctx.fillRect(0,0,k.halfs.B.width,k.halfs.B.height);const t=h(k.screenA.width,k.screenA.height),e=k.screenA.scale;k.camA={sd:o(t,1),dd:o(t,e),sp:o(t,-.5),dp:o(r(t,o(t,e)),.5)}}window.addEventListener("resize",J,!1),J(),k.render=function(){if(k.screenA.ctx.fillRect(0,0,k.halfs.A.width,k.halfs.A.height),this.state.camA&&this.state.scrA){const t=this.state.camA,e=this.camA;this.screenA.ctx.drawImage(this.state.scrA,e.sp.x+t.x,e.sp.y+t.y,e.sd.x,e.sd.y,e.dp.x,e.dp.y,e.dd.x,e.dd.y)}this.screen.ctx.drawImage(this.screenA,this.halfs.A.x,this.halfs.A.y),this.screen.ctx.drawImage(this.screenB,this.halfs.B.x,this.halfs.B.y)},k.changeStateInn=function(){this.state=new q(this),this.loop.setState(this.state)}}]);