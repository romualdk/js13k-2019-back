!function(t){var s={};function i(e){if(s[e])return s[e].exports;var h=s[e]={i:e,l:!1,exports:{}};return t[e].call(h.exports,h,h.exports,i),h.l=!0,h.exports}i.m=t,i.c=s,i.d=function(t,s,e){i.o(t,s)||Object.defineProperty(t,s,{enumerable:!0,get:e})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,s){if(1&s&&(t=i(t)),8&s)return t;if(4&s&&"object"==typeof t&&t&&t.__esModule)return t;var e=Object.create(null);if(i.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&s&&"string"!=typeof t)for(var h in t)i.d(e,h,function(s){return t[s]}.bind(null,h));return e},i.n=function(t){var s=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(s,"a",s),s},i.o=function(t,s){return Object.prototype.hasOwnProperty.call(t,s)},i.p="",i(i.s=0)}([function(t,s,i){"use strict";function e(t,s,i){const e=i?document.getElementById(i):document.createElement("canvas");return e.width=t,e.height=s,e.ctx=e.getContext("2d"),e}i.r(s);const h=(t,s)=>({x:t,y:s}),r=t=>h(t.x,t.y),a=(t,s)=>h(t.x+s.x,t.y+s.y),n=(t,s)=>a(t,o(s,-1)),c=(t,s)=>h(t.x*s.x,t.y*s.y),o=(t,s)=>h(t.x*s,t.y*s),l=t=>m(t,t)**.5,d=(t,s)=>l(n(t,s)),m=(t,s)=>t.x*s.x+t.y*s.y,f=(t,s)=>h(t%s,Math.floor(t/s)),u=(t,s,i,e)=>{const r=((t,s)=>c(f(s-1,t.cols),h(t.tw,t.th)))(s,e);t.ctx.drawImage(s.img,r.x,r.y,s.tw,s.th,i.x,i.y,s.tw,s.th)},g=t=>t[(t=>Math.floor(Math.random()*t))(t.length)],w=(t,s,i=[])=>({w:t,h:s,data:i}),p=(t,s,i)=>c(f(i,t.w),h(s.tw,s.th)),x=(t,s)=>{t.data=new Array(t.w*t.h).fill(s)},y=(t,s,i)=>{t.data[((t,s)=>t.x+t.y*s)(s,t.w)]=i},A=(t,s,i)=>{for(let e in i.data)i.data[e]>0&&y(t,a(s,f(e,i.w)),i.data[e])},B=(t,s)=>{const i=e(t.w*s.tw,t.h*s.th);for(let e in t.data)u(i,s,p(t,s,e),t.data[e]);return i},S={tower:w(9,15,[0,9,13,13,13,13,13,9,0,0,17,11,35,35,35,11,17,0,0,17,1,25,28,27,1,17,0,0,17,1,33,33,33,1,17,0,0,17,1,25,28,27,1,17,0,0,17,1,33,33,33,1,17,0,0,10,13,13,13,13,13,10,0,0,17,11,17,20,17,11,17,0,51,42,17,49,20,49,17,42,52,53,26,20,57,17,57,17,26,53,53,26,17,20,17,20,21,26,53,53,26,20,17,49,20,20,26,53,53,43,20,17,57,20,17,43,53,53,26,20,20,57,17,20,41,53,59,61,61,61,45,61,61,61,60]),inn:w(17,17,[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,1,1,1,1,1,2,1,1,17,19,17,17,17,19,17,1,1,1,1,1,1,1,1,7,1,17,1,46,47,48,1,17,2,1,1,1,1,1,7,1,1,1,17,1,1,1,1,101,17,1,1,1,1,2,1,1,1,17,17,17,17,17,17,17,29,17,1,1,1,17,17,17,17,17,17,1,38,1,56,1,1,58,17,1,7,1,19,1,1,30,39,17,1,1,1,1,1,102,1,17,7,1,7,17,32,1,1,58,29,1,31,31,31,1,1,1,17,2,1,1,17,1,1,37,1,17,1,14,15,16,1,1,1,17,19,17,1,17,17,17,17,17,17,1,31,31,31,1,1,31,22,31,17,1,19,1,1,30,39,17,1,1,1,1,1,1,31,23,31,17,1,17,32,1,1,58,29,1,1,1,1,1,1,31,24,31,17,1,17,1,1,37,1,17,1,1,1,1,1,1,1,1,1,17,2,17,17,17,17,17,17,36,1,1,1,58,1,1,1,36,17,1,1,2,1,1,1,17,17,17,19,17,29,17,19,17,17,17,1,7,1,2,1,1,1,2,1,1,1,50,40,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,50,1,1,1,2,1,1]),graves:w(5,5,[66,1,68,1,65,3,3,3,3,3,65,1,3,1,66,1,1,3,69,1,67,1,3,1,67]),fort:w(4,3,[0,13,0,0,13,18,17,0,17,17,17,44]),house:w(5,3,[0,34,34,34,0,34,21,17,21,34,17,21,29,21,17]),castle:w(9,10,[51,61,61,61,61,61,61,61,52,53,9,13,13,13,13,13,9,53,53,17,11,35,35,35,11,17,53,53,17,1,17,29,17,1,17,53,53,17,1,1,50,1,1,17,53,53,17,1,58,50,1,1,17,53,53,17,1,1,50,58,1,17,53,53,10,13,13,13,13,13,10,53,53,17,11,17,49,17,11,17,53,59,61,61,61,45,61,61,61,60]),castleroom:w(17,15,[17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,26,43,26,26,63,26,26,42,26,26,64,26,26,43,26,17,17,26,1,1,1,1,1,1,1,1,1,1,1,1,1,26,17,17,26,1,37,4,4,62,4,4,4,62,4,4,37,1,26,17,17,26,1,1,1,1,1,1,1,1,1,1,1,4,1,26,17,17,26,1,4,4,4,4,4,4,4,4,4,1,4,1,26,17,17,26,1,4,1,1,1,1,1,1,1,4,1,4,1,26,17,17,26,1,4,1,4,4,4,4,4,1,4,1,4,1,26,17,17,26,1,4,1,4,1,1,1,1,1,4,1,4,1,26,17,17,26,1,4,1,4,4,4,4,4,4,4,1,4,1,26,17,17,26,1,4,1,1,1,1,1,1,1,1,1,4,1,26,17,17,26,1,37,4,4,4,4,4,4,4,4,4,37,1,26,17,17,26,55,1,1,1,1,1,1,1,1,1,1,1,55,26,17,17,17,17,13,17,13,17,13,13,13,17,13,17,13,17,17,17,17,17,17,17,17,17,17,17,29,17,17,17,17,17,17,17,17]),struct1:w(2,1,[17,44]),struct2:w(2,1,[17,55]),struct3:w(2,1,[12,17]),struct4:w(1,1,[12]),struct5:w(1,1,[55]),struct6:w(1,1,[44])},M=[S.struct1,S.struct2,S.struct3,S.struct4,S.struct5,S.struct6],v=[1,1,1,2,7,7],b=new Array(10).fill(1).concat(2),z=new Array(4).fill(1).concat(new Array(4).fill(2)),I=new Array(2).fill(b).concat(new Array(2).fill(z)).concat([v,v,v]),O=t=>{((t,s)=>{for(let i in t.data)t.data[i]=g(s)})(t,v)},E=(t,s=0)=>{const i=Math.floor(t.w/2);for(let e=s;e<t.h;e++){y(t,h(i,e),50);for(let s=0;s<I.length;s++)y(t,h(i-s-1,e),g(I[s])),y(t,h(i+s+1,e),g(I[s]))}},F=()=>{const t=w(33,99);x(t,1),O(t),E(t,70);const s=[[12,65,S.tower],[24,63,S.graves],[24,80,S.house],[9,82,g(M)],[7,84,g(M)],[10,83,g(M)],[21,86,g(M)]];for(let i in s)A(t,h(s[i][0],s[i][1]),s[i][2]);return t},j=()=>{const t=w(33,33);return x(t,1),A(t,h(8,8),S.inn),t},P=1e3/60,_=1/60;class H{constructor(t){this.raf=null,this.setState(t)}setState(t){this.state=t}start(){this.now=performance.now(),this.last=this.now,this.elapsed=0,this.accumulator=0,requestAnimationFrame(this.update.bind(this))}stop(){cancelAnimationFrame(this.raf)}update(){if(this.raf=requestAnimationFrame(this.update.bind(this)),this.now=performance.now(),this.elapsed=this.now-this.last,this.last=this.now,!(this.elapsed>1e3)){for(this.state.prepare(),this.accumulator+=this.elapsed;this.accumulator>=P;)this.state.update(_),this.accumulator-=P;this.state.render()}}}const R=32,T=12;class W{constructor(t,s){this.game=t,this.txt=s,this.ctxt=[],this.fnt=this.game.fnt,this.canvas=e(R*this.fnt.size,T*this.fnt.size*2),this.time=0,this.line=0,this.linewait=1,this.screen=0}update(t){this.time+=t,this.time>=this.linewait&&(this.txt[this.screen][this.line][0]&&this.ctxt.push(this.txt[this.screen][this.line][0]),this.time=0,this.linewait=this.txt[this.screen][this.line][1],this.line+=1)}render(){for(let t in this.ctxt){const s=Math.floor((R-this.ctxt[t].length)/2)*this.fnt.size;this.fnt.text(this.canvas.ctx,s,t*this.fnt.size*2,this.ctxt[t])}}}const C=t=>t<.5?2*t*t:(4-2*t)*t-1,G=[[["SOUTHERN TOWER OF SPELLS",0],["is known for powerful mages",2],[" ",0],["After years of education",0],["YOUNG MAGE",2],[" ",0],["GOES BACK",1],["to his village"]]];class L{constructor(t){this.game=t,this.map=F(),this.map.img=B(this.map,this.game.tls),this.player=h(256,1264),this.scrA=e(this.map.img.width,this.map.img.height);const s=this.scrA.width/2;this.start=h(s,384),this.end=h(s,this.scrA.height-384),this.camA=r(this.start),this.time=0,this.endtime=5,this.distance=d(this.start,this.end),this.inter=new W(this.game,G),this.scrB=this.inter.canvas,this.camB=o(h(this.scrB.width,this.scrB.height),.5)}prepare(){}update(t){this.time+=t,this.inter.update(t),this.time<=this.endtime&&(this.camA.y=this.start.y+Math.floor(C(this.time/this.endtime)*this.distance)),this.time>=6&&(this.player.y+=30*t),this.time>=10&&this.game.changeStateInn()}render(){this.scrA.ctx.drawImage(this.map.img,0,0),u(this.scrA,this.game.tls,this.player,97),this.inter.render(),this.game.render()}}class q{constructor(t){this.game=t,this.map=j(),this.map.image=B(this.map,this.game.tls),this.pos={x:256,y:272},this.width=528,this.height=528,this.halfWidth=this.width/2,this.halfHeight=this.height/2}prepare(){}update(t){}render(){const t=this.game.screenA.scale;this.game.screenB.ctx.fillStyle="#091431",this.game.screenB.ctx.fillRect(0,0,this.game.screenB.width,this.game.screenB.height);const s=this.pos.x-this.halfWidth,i=this.pos.y-this.halfHeight,e=this.width,h=this.height,r=e*t,a=h*t,n=(this.game.screenA.width-r)/2,c=(this.game.screenA.height-a)/2;this.game.screenA.ctx.drawImage(this.map.image,s,i,e,h,n,c,r,a),this.game.render()}}let N=0;function U(){(N+=1)>=2&&(k.state=new L(k),k.loop=new H(k.state),k.loop.start())}const k={};k.imgFont=new Image,k.fnt=new class{constructor(t,s,i,e){this.image=t,this.size=s,this.columns=i,this.start=e}text(t,s,i,e){let h=s,r=i;for(let s in e){const i=e.charCodeAt(s)-this.start,a=i%this.columns*this.size,n=Math.floor(i/this.columns)*this.size;t.drawImage(this.image,a,n,this.size,this.size,h,r,this.size,this.size),h+=this.size}}}(k.imgFont,8,16,48),k.imgFont.onload=U,k.imgFont.src="./img/font.png",k.img=new Image,k.tls=((t,s,i,e)=>({img:t,tw:s,th:i,cols:e}))(k.img,16,16,8),k.img.onload=U,k.img.src="./img/tileset.png";const K=33*k.tls.tw,Y=33*k.tls.th;function D(){k.scr=e(window.innerWidth,window.innerHeight,"screen"),k.halfs=function(t,s){const i=t<=s,e=i?t:Math.floor(t/2),h=i?Math.floor(s/2):s;return{A:{x:0,y:0,width:e,height:h},B:{x:i?0:t-e,y:i?s-h:0,width:e,height:h}}}(k.scr.width,k.scr.height),k.scrA=e(k.halfs.A.width,k.halfs.A.height),k.scrB=e(k.halfs.B.width,k.halfs.B.height),k.s=function(t,s){const i=Math.ceil(t.width/s.width),e=Math.ceil(t.height/s.height);return Math.min(i,e)}(k.halfs.A,{width:K,height:Y}),k.scr.ctx.fillStyle="#091431",k.scrA.ctx.fillStyle="#472d3c",k.scrB.ctx.fillStyle="#091431";const t=h(k.scrA.width,k.scrA.height);k.cam={sd:o(t,1),dd:o(t,k.s),sp:o(t,-.5),dp:o(n(t,o(t,k.s)),.5)}}window.addEventListener("resize",D,!1),D(),k.render=function(){J(this.scr),J(this.scrA),J(this.scrB),Q(this.scrA.ctx,this.state.scrA,this.cam,this.state.camA),Q(this.scrB.ctx,this.state.scrB,this.cam,this.state.camB),this.scr.ctx.drawImage(this.scrA,this.halfs.A.x,this.halfs.A.y),this.scr.ctx.drawImage(this.scrB,this.halfs.B.x,this.halfs.B.y)};const J=t=>{t.ctx.fillRect(0,0,t.width,t.height)},Q=(t,s,i,e)=>{t.drawImage(s,i.sp.x+e.x,i.sp.y+e.y,i.sd.x,i.sd.y,i.dp.x,i.dp.y,i.dd.x,i.dd.y)};k.changeStateInn=function(){this.state=new q(this),this.loop.setState(this.state)}}]);