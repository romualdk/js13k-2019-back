!function(t){var s={};function i(e){if(s[e])return s[e].exports;var h=s[e]={i:e,l:!1,exports:{}};return t[e].call(h.exports,h,h.exports,i),h.l=!0,h.exports}i.m=t,i.c=s,i.d=function(t,s,e){i.o(t,s)||Object.defineProperty(t,s,{enumerable:!0,get:e})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,s){if(1&s&&(t=i(t)),8&s)return t;if(4&s&&"object"==typeof t&&t&&t.__esModule)return t;var e=Object.create(null);if(i.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&s&&"string"!=typeof t)for(var h in t)i.d(e,h,function(s){return t[s]}.bind(null,h));return e},i.n=function(t){var s=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(s,"a",s),s},i.o=function(t,s){return Object.prototype.hasOwnProperty.call(t,s)},i.p="",i(i.s=0)}([function(t,s,i){"use strict";function e(t,s,i){const e=i?document.getElementById(i):document.createElement("canvas");return e.width=t,e.height=s,e.ctx=e.getContext("2d"),e}i.r(s);const h=(t,s)=>({x:t,y:s}),a=(t,s)=>h(t.x+s.x,t.y+s.y),n=(t,s)=>a(t,c(s,-1)),r=(t,s)=>h(t.x*s.x,t.y*s.y),c=(t,s)=>h(t.x*s,t.y*s),o=(t,s)=>h(t%s,Math.floor(t/s)),l=(t,s,i,e)=>{const a=((t,s)=>r(o(s-1,t.cols),h(t.tw,t.th)))(s,e);t.ctx.drawImage(s.img,a.x,a.y,s.tw,s.th,i.x,i.y,s.tw,s.th)},m=t=>Math.floor(Math.random()*t),d=t=>t[m(t.length)],p=(t,s,i=[])=>({w:t,h:s,data:i}),u=(t,s,i)=>r(o(i,t.w),h(s.tw,s.th)),g=(t,s)=>{t.data=new Array(t.w*t.h).fill(s)},f=(t,s,i)=>{t.data[((t,s)=>t.x+t.y*s)(s,t.w)]=i},w=(t,s,i)=>{for(let e in i.data)i.data[e]>0&&f(t,a(s,o(e,i.w)),i.data[e])},A=(t,s)=>{const i=e(t.w*s.tw,t.h*s.th);for(let e in t.data)l(i,s,u(t,s,e),t.data[e]);return i},y={tower:p(9,15,[0,9,13,13,13,13,13,9,0,0,17,11,35,35,35,11,17,0,0,17,1,25,28,27,1,17,0,0,17,1,33,33,33,1,17,0,0,17,1,25,28,27,1,17,0,0,17,1,33,33,33,1,17,0,0,10,13,13,13,13,13,10,0,0,17,11,17,20,17,11,17,0,51,42,17,49,20,49,17,42,52,53,26,20,57,17,57,17,26,53,53,26,17,20,17,20,21,26,53,53,26,20,17,49,20,20,26,53,53,43,20,17,57,20,17,43,53,53,26,20,20,57,17,20,41,53,59,61,61,61,45,61,61,61,60]),inn:p(17,17,[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,1,1,1,1,1,2,1,1,17,19,17,17,17,19,17,1,1,1,1,1,1,1,1,7,1,17,1,46,47,48,1,17,2,1,1,1,1,1,7,1,1,1,17,1,1,1,1,101,17,1,1,1,1,2,1,1,1,17,17,17,17,17,17,17,29,17,1,1,1,17,17,17,17,17,17,1,38,1,56,1,1,58,17,1,7,1,19,1,1,30,39,17,1,1,1,1,1,102,1,17,7,1,7,17,32,1,1,58,29,1,31,31,31,1,1,1,17,2,1,1,17,1,1,37,1,17,1,14,15,16,1,1,1,17,19,17,1,17,17,17,17,17,17,1,31,31,31,1,1,31,22,31,17,1,19,1,1,30,39,17,1,1,1,1,1,1,31,23,31,17,1,17,32,1,1,58,29,1,1,1,1,1,1,31,24,31,17,1,17,1,1,37,1,17,1,1,1,1,1,1,1,1,1,17,2,17,17,17,17,17,17,36,1,1,1,58,1,1,1,36,17,1,1,2,1,1,1,17,17,17,19,17,29,17,19,17,17,17,1,7,1,2,1,1,1,2,1,1,1,50,40,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,50,1,1,1,2,1,1]),graves:p(5,5,[66,1,68,1,65,3,3,3,3,3,65,1,3,1,66,1,1,3,69,1,67,1,3,1,67]),fort:p(4,3,[0,13,0,0,13,18,17,0,17,17,17,44]),house:p(5,3,[0,34,34,34,0,34,21,17,21,34,17,21,29,21,17]),castle:p(9,10,[51,61,61,61,61,61,61,61,52,53,9,13,13,13,13,13,9,53,53,17,11,35,35,35,11,17,53,53,17,1,17,29,17,1,17,53,53,17,1,1,50,1,1,17,53,53,17,1,58,50,1,1,17,53,53,17,1,1,50,58,1,17,53,53,10,13,13,13,13,13,10,53,53,17,11,17,49,17,11,17,53,59,61,61,61,45,61,61,61,60]),castleroom:p(17,15,[17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,26,43,26,26,63,26,26,42,26,26,64,26,26,43,26,17,17,26,1,1,1,1,1,1,1,1,1,1,1,1,1,26,17,17,26,1,37,4,4,62,4,4,4,62,4,4,37,1,26,17,17,26,1,1,1,1,1,1,1,1,1,1,1,4,1,26,17,17,26,1,4,4,4,4,4,4,4,4,4,1,4,1,26,17,17,26,1,4,1,1,1,1,1,1,1,4,1,4,1,26,17,17,26,1,4,1,4,4,4,4,4,1,4,1,4,1,26,17,17,26,1,4,1,4,1,1,1,1,1,4,1,4,1,26,17,17,26,1,4,1,4,4,4,4,4,4,4,1,4,1,26,17,17,26,1,4,1,1,1,1,1,1,1,1,1,4,1,26,17,17,26,1,37,4,4,4,4,4,4,4,4,4,37,1,26,17,17,26,55,1,1,1,1,1,1,1,1,1,1,1,55,26,17,17,17,17,13,17,13,17,13,13,13,17,13,17,13,17,17,17,17,17,17,17,17,17,17,17,29,17,17,17,17,17,17,17,17]),struct1:p(2,1,[17,44]),struct2:p(2,1,[17,55]),struct3:p(2,1,[12,17]),struct4:p(1,1,[12]),struct5:p(1,1,[55]),struct6:p(1,1,[44])},x=[y.struct1,y.struct2,y.struct3,y.struct4,y.struct5,y.struct6],E=[1,1,1,2,7,7],M=new Array(10).fill(1).concat(2),R=new Array(4).fill(1).concat(new Array(4).fill(2)),v=new Array(2).fill(M).concat(new Array(2).fill(R)).concat([E,E,E]),S=t=>{((t,s)=>{for(let i in t.data)t.data[i]=d(s)})(t,E)},O=(t,s=0)=>{const i=Math.floor(t.w/2);for(let e=s;e<t.h;e++){f(t,h(i,e),50);for(let s=0;s<v.length;s++)f(t,h(i-s-1,e),d(v[s])),f(t,h(i+s+1,e),d(v[s]))}},I=()=>{const t=p(33,33);return g(t,1),w(t,h(8,8),y.inn),t},b=()=>{const t=p(33,231);g(t,1),S(t),O(t,33);const s=[[12,24,y.castle],[21,67,y.graves],[20,35,y.house],[9,36,y.fort],[8,41,d(x)],[9,43,d(x)],[27,38,d(x)],[25,41,d(x)]];for(let i in s)w(t,h(s[i][0],s[i][1]),s[i][2]);return t},k=1e3/60,z=1/60;class B{constructor(t){this.raf=null,this.setState(t)}setState(t){this.state=t}start(){this.now=performance.now(),this.last=this.now,this.elapsed=0,this.accumulator=0,requestAnimationFrame(this.update.bind(this))}stop(){cancelAnimationFrame(this.raf)}update(){if(this.raf=requestAnimationFrame(this.update.bind(this)),this.now=performance.now(),this.elapsed=this.now-this.last,this.last=this.now,!(this.elapsed>1e3)){for(this.state.prepare(),this.accumulator+=this.elapsed;this.accumulator>=k;)this.state.update(z),this.accumulator-=k;this.state.render()}}}const L=36,U=12,C="en";class F{constructor(t,s,i){this.game=t;const h=s[i]?i:C;this.txt=s[h],this.ctxt=[],this.fnt=this.game.fnt,this.canvas=e(L*this.fnt.size,U*this.fnt.size*2),this.time=0,this.line=0,this.linewait=1,this.screen=0}update(t){this.time+=t,this.txt[this.screen]&&(this.line>=this.txt[this.screen].length&this.time>=this.linewait&&(this.screen+=1,this.line=0,this.linewait=0,this.ctxt=[],this.canvas.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)),this.time>=this.linewait&this.screen<this.txt.length&&(this.txt[this.screen][this.line][0]&&this.ctxt.push(this.txt[this.screen][this.line][0]),this.time=0,this.linewait=this.txt[this.screen][this.line][1],this.line+=1))}render(){for(let t in this.ctxt){const s=Math.floor((L-this.ctxt[t].length)/2)*this.fnt.size;this.fnt.text(this.canvas.ctx,s,t*this.fnt.size*2,this.ctxt[t])}}}const D={tower:{en:[[["SOUTHERN TOWER OF SPELLS",0],["is known for powerful mages",2],[" ",0],["After years of education",0],["YOUNG MAGE",2],[" ",0],["GOES BACK",1],["to his village",4]]],pl:[[["POLUDNIOWA WIEZA CZAROW",0],["jest znana z poteznych magow",2],[" ",0],["Po latach edukacji",0],["MLODY MAG",2],[" ",0],["WRACA",2],["do swojej wioski",4]]],fr:[[["TOUR DU SUD DES SORTS",0],["est connu pour les mages puissants",2],[" ",0],["Apres des annees deducation",0],["JEUNE MAGE",2],[" ",0],["RETOURNE",1],["a son village",4]]],sp:[[["TORRE DEL SUR DE HECHIZOS",0],["es conocido por poderosos magos",2],[" ",0],["Despues de anios de educacion",0],["JOVEN MAGE",2],[" ",0],["REGRESA",1],["a su pueblo",4]]],de:[[["SUDTURM DER ZAUBER",0],["ist bekannt fur machtige Magier",2],[" ",0],["Nach Jahren der Erziehung",0],["JUNGER MAGIER",2],[" ",0],["GEHT ZURUCK",1],["zu seinem Dorf",4]]]},inn:{en:[[["You heard about NORTH CASTLE?",2],[" ",0],["About DARK MAGE?",2],[" ",0],["Yes: He imprisoned THE KING",2],[" ",0],["There is REWARD",0],["if you kill him",0],["and free the king",2]],[["I could help you",2],[" ",0],["Are you a mage?",2],[" ",0],["Woudl be useful for black mage",2],[" ",0],["No more talking: Lets go!",4]]],pl:[[["Slyszeliscie o ZAMKU POLNOCY?",2],[" ",0],["o CZARNYM MAGU?",2],[" ",0],["Tak: Uwiezil KROLA",2],[" ",0],["Jest NAGRODA",0],["jesli go zabijesz",0],["i uwolnisz krola",2]],[["Moglbym wam pomoc",2],[" ",0],["Jestes magiem?",2],[" ",0],["Przydalby sie na czarnego maga",2],[" ",0],["Bez gadania: Ruszajmy!",4]]]}};class T{constructor(t,s,i){this.state=t,this.pos=s,this.vel=h(0,0),this.speed=40,this.maxDist=12,this.tile=i}follow(t){this.toFollow=t}walk(){this.vel.y=-this.speed,this.toFollow=null}update(t){if(this.toFollow){const t=Math.abs(this.pos.y-this.toFollow.pos.y);this.vel.y=t>this.maxDist?-this.speed:0}this.pos=a(this.pos,c(this.vel,t))}render(t){const s=h(Math.floor(this.pos.x),Math.floor(this.pos.y));l(t,this.state.game.tls,s,this.tile)}}class H{constructor(t){this.game=t,this.map=b(),this.map.img=A(this.map,this.game.tls),this.p1=new T(this,h(this.map.img.width/2-8,this.map.img.height-256),97),this.npc1=new T(this,a(this.p1.pos,h(0,-32)),98),this.npc2=new T(this,a(this.p1.pos,h(-24,-24)),99),this.npc3=new T(this,a(this.p1.pos,h(24,-24)),100),this.p1.follow(this.npc1),this.p1.maxDist=24,this.npc2.follow(this.npc1),this.npc3.follow(this.npc1),this.npc1.walk(),this.scrA=e(this.map.img.width,this.map.img.height),this.camA=h(0,0),this.time=0,this.inter=new F(this.game,D.inn,this.game.lang),this.scrB=this.inter.canvas,this.camB=c(h(this.scrB.width,this.scrB.height),.5)}prepare(){}update(t){this.npc1.update(t),this.npc2.update(t),this.npc3.update(t),this.p1.update(t);const s=1===this.game.s?-1*this.game.cam.sd.y/2+48:-1*this.game.cam.dd.y/10;this.camA=a(this.p1.pos,h(8,s))}render(){this.scrA.ctx.drawImage(this.map.img,0,0),this.p1.render(this.scrA),this.npc1.render(this.scrA),this.npc2.render(this.scrA),this.npc3.render(this.scrA),this.inter.render(),this.game.render()}}class G{constructor(t){this.game=t,this.map=I(),this.map.img=A(this.map,this.game.tls),this.player=h(288,320),this.npc1=h(240,240),this.npc2=h(256,272),this.npc3=h(272,240);const s=h(0,-16),i=h(-100,-100),n=a(this.npc1,s),r=a(this.npc2,s),o=a(this.npc3,s),l=a(this.player,s);this.marks=[i,n,n,r,r,o,o,n,n,l,l,n,n,r,r,o,o],this.cmark=0,this.scrA=e(this.map.img.width,this.map.img.height),this.camA=c(h(this.scrA.width,this.scrA.height),.5),this.time=0,this.inter=new F(this.game,D.inn,this.game.lang),this.scrB=this.inter.canvas,this.camB=c(h(this.scrB.width,this.scrB.height),.5)}prepare(){}update(t){this.time+=t,this.inter.update(t),this.cmark=Math.floor(this.time),this.cmark=this.marks[this.cmark]?this.cmark:0,this.time>=18&&this.game.changeStateForest()}render(){this.scrA.ctx.drawImage(this.map.img,0,0),l(this.scrA,this.game.tls,this.player,97),l(this.scrA,this.game.tls,this.npc1,98),l(this.scrA,this.game.tls,this.npc2,99),l(this.scrA,this.game.tls,this.npc3,100),l(this.scrA,this.game.tls,this.marks[this.cmark],71),this.inter.render(),this.game.render()}}const N=(t,s=39,i=29)=>s*Math.min(t,i)**2,j=(()=>{let t={1:0};for(let s=2;s<=50;s++)t[s]=t[s-1]+N(s-1);return t})(),W={1:0,2:1,4:2,6:3,8:4,16:5},P={hp:[35,30,33,30,28,25],str:[20,5,5,10,5,1],agi:[5,10,5,10,5,10],int:[1,5,5,10,15,20],vit:[10,5,20,5,10,1],lck:[5,15,5,5,5,10],hit:[10,5,5,7,5,5],mdef:[15,15,10,20,20,20]},Z={str:[49,33,24,25,18,13],agi:[35,32,25,17,18,13],int:[14,17,24,24,29,49],vit:[25,16,49,22,20,14],lck:[24,49,30,25,19,14],hit:[3,2,3,2,1,1],mdef:[3,2,4,2,2,2]};const J=(t,s)=>t+Math.floor(Math.random()*(s-t)),K=(t,s,i,e,h,a)=>({name:t,elem:s,eff:i,acc:e,target:h,usable:a}),Y=[K("CURE",0,15,0,0,0),K("CUR2",0,33,0,0,0),K("CUR3",0,66,0,0,0),K("CUR4",0,0,0,8),K("HEAL",0,12,0,2,8),K("HEL2",0,48,0,2,8),K("HEL3",0,48,48,2,8),K("HARM",0,20,24,3,8),K("HRM2",0,40,24,3,8),K("HRM3",0,60,24,3,8),K("FIRE",16,10,24,1,0),K("FIR2",16,30,24,1,0),K("FIR3",16,50,24,1,0),K("LIT",64,10,24,1,0),K("LIT2",64,30,24,1,0),K("LIT3",64,60,24,1,0),K("ICE",32,20,24,1,0),K("ICE2",32,40,24,1,0),K("ICE3",32,70,24,1,0)],_=(t,s,i,e,h,a,n,r,c,o,l,m,d)=>({name:t,type:s,hp:i,atk:e,acc:h,crt:a,def:n,eva:r,mdef:c,weak:o,resi:l,gold:m,exp:d}),q=[_("IMP",4,8,4,2,1,4,6,16,0,0,6,6),_("GrIMP",4,16,8,4,1,6,9,23,0,0,18,18),_("WOLF",0,20,8,5,1,0,36,28,0,0,6,24),_("GrWOLF",0,72,14,18,1,0,54,46,0,0,22,93),_("WrWOLF",0,68,14,17,1,6,42,45,0,0,67,135),_("FrWOLF",0,92,25,23,1,0,54,55,16,32,200,402),_("BONE",8,10,10,2,1,0,12,17,16,32,3,9),_("RBONE",8,144,26,36,1,12,42,76,16,32,378,378),_("CREEP",0,56,17,14,1,8,24,40,16,0,15,63),_("CRAWL",0,84,1,21,1,8,42,51,0,0,200,186),_("LICH",0,500,50,64,1,50,48,140,0,32,1,2e3)];let V=new class{constructor(t){this.type=t,this.setStats()}setStats(){this.lvl=1,this.exp=0;for(let t in P)this[t]=P[t][W[this.type]];this.calcStats(),this.resi=0,this.weak=0}calcStats(){this.att=Math.floor(this.vit/4),this.def=this.lvl,this.crt=2*this.lvl,this.eva=48+this.agi}addExp(t){let s=!0;for(this.exp+=t;s;)(s=this.exp>=j[this.lvl+1])&&(this.lvl+=1,this.gainStats(),this.calcStats())}gainStats(){for(let t in Z)this[t]+=Z[t][W[this.type]];this.hp+=Math.floor(this.vit/4)}}(1);console.log(V),V.addExp(200),console.log(V),console.log(Y),console.log(q),console.log((t,s)=>{const i=s.resi&&t.elem,e=s.weak&&t.elem,h=(i?0:e?188:148)+t.Acc-s.Mdef,a=J(0,200),n=(0===a||a<=h)&&200!==a,r=t.Eff*(i?1:e?3:2);return(n+1)*J(r,2*r)},(t,s)=>{const i=148+t.acc-s.mdef,e=J(0,200);return(0===e||e<=i)&&200!==e?"CUR4"===t.name?s.hp-s.currentHp:J(t.eff,2*t.eff):0},(t,s)=>{const i=168+t.Hit-s.Eva,e=J(0,200);return(0===e||e<=i)&&200!==e?((0===e||e<=t.Crt)+1)*J(t.Att,2*t.Att)-s.Def:0});let Q=0;function X(){(Q+=1)>=2&&($.state=new H($),$.loop=new B($.state),$.loop.start())}const $={};$.lang=(()=>(window.navigator.userLanguage||window.navigator.language).substring(0,2))(),$.imgFont=new Image,$.fnt=new class{constructor(t,s,i,e){this.image=t,this.size=s,this.columns=i,this.start=e}text(t,s,i,e){let h=s,a=i;for(let s in e){const i=e.charCodeAt(s)-this.start,n=i%this.columns*this.size,r=Math.floor(i/this.columns)*this.size;t.drawImage(this.image,n,r,this.size,this.size,h,a,this.size,this.size),h+=this.size}}}($.imgFont,8,16,48),$.imgFont.onload=X,$.imgFont.src="./img/font.png",$.img=new Image,$.tls=((t,s,i,e)=>({img:t,tw:s,th:i,cols:e}))($.img,16,16,8),$.img.onload=X,$.img.src="./img/tileset.png";const tt=33*$.tls.tw,st=33*$.tls.th;function it(){$.scr=e(window.innerWidth,window.innerHeight,"screen"),$.halfs=function(t,s){const i=t<=s,e=i?t:Math.floor(t/2),h=i?Math.floor(s/2):s;return{A:{x:0,y:0,width:e,height:h},B:{x:i?0:t-e,y:i?s-h:0,width:e,height:h}}}($.scr.width,$.scr.height),$.scrA=e($.halfs.A.width,$.halfs.A.height),$.scrB=e($.halfs.B.width,$.halfs.B.height),$.s=function(t,s){const i=Math.ceil(t.width/s.width),e=Math.ceil(t.height/s.height);return Math.min(i,e)}($.halfs.A,{width:tt,height:st}),$.scr.ctx.fillStyle="#091431",$.scrA.ctx.fillStyle="#472d3c",$.scrB.ctx.fillStyle="#091431";const t=h($.scrA.width,$.scrA.height);$.cam={sd:c(t,1),dd:c(t,$.s),sp:c(t,-.5),dp:c(n(t,c(t,$.s)),.5)}}window.addEventListener("resize",it,!1),it(),$.render=function(){et(this.scr),et(this.scrA),et(this.scrB),ht(this.scrA.ctx,this.state.scrA,this.cam,this.state.camA),ht(this.scrB.ctx,this.state.scrB,this.cam,this.state.camB),this.scr.ctx.drawImage(this.scrA,this.halfs.A.x,this.halfs.A.y),this.scr.ctx.drawImage(this.scrB,this.halfs.B.x,this.halfs.B.y)};const et=t=>{t.ctx.fillRect(0,0,t.width,t.height)},ht=(t,s,i,e)=>{t.drawImage(s,i.sp.x+e.x,i.sp.y+e.y,i.sd.x,i.sd.y,i.dp.x,i.dp.y,i.dd.x,i.dd.y)};$.changeStateInn=function(){this.state=new G(this),this.loop.setState(this.state)},$.changeStateForest=function(){this.state=new H(this),this.loop.setState(this.state)}}]);