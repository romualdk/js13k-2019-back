!function(t){var e={};function i(s){if(e[s])return e[s].exports;var h=e[s]={i:s,l:!1,exports:{}};return t[s].call(h.exports,h,h.exports,i),h.l=!0,h.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var h in t)i.d(s,h,function(e){return t[e]}.bind(null,h));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";function s(t,e,i){const s=i?document.getElementById(i):document.createElement("canvas");return s.width=t,s.height=e,s.ctx=s.getContext("2d"),s}i.r(e);const h=(t,e)=>({x:t,y:e}),a=(t,e)=>h(t.x+e.x,t.y+e.y),n=(t,e)=>h(t.x*e.x,t.y*e.y),r=(t,e)=>h(t%e,Math.floor(t/e)),c=(t,e)=>n(r(e-1,t.cols),h(t.tw,t.th)),l=(t,e,i,s)=>{const h=c(e,s);t.ctx.drawImage(e.img,h.x,h.y,e.tw,e.th,i.x,i.y,e.tw,e.th)},o=1e3/60,m=1/60;class g{constructor(t){this.raf=null,this.setState(t)}setState(t){this.state=t}start(){this.now=performance.now(),this.last=this.now,this.elapsed=0,this.accumulator=0,requestAnimationFrame(this.update.bind(this))}stop(){cancelAnimationFrame(this.raf)}update(){if(this.raf=requestAnimationFrame(this.update.bind(this)),this.now=performance.now(),this.elapsed=this.now-this.last,this.last=this.now,!(this.elapsed>1e3)){for(this.state.prepare(),this.accumulator+=this.elapsed;this.accumulator>=o;)this.state.update(m),this.accumulator-=o;this.state.render()}}}const d=32,f=12;class u{constructor(t,e){this.game=t,this.txt=e,this.ctxt=[],this.fnt=this.game.fnt,this.canvas=s(d*this.fnt.size,f*this.fnt.size*2),this.time=0,this.line=0,this.linewait=1,this.screen=0}update(t){this.time+=t,this.time>=this.linewait&&(this.txt[this.screen][this.line][0]&&this.ctxt.push(this.txt[this.screen][this.line][0]),this.time=0,this.linewait=this.txt[this.screen][this.line][1],this.line+=1)}render(){for(let t in this.ctxt){const e=Math.floor((d-this.ctxt[t].length)/2)*this.fnt.size;this.fnt.text(this.canvas.ctx,e,t*this.fnt.size*2,this.ctxt[t])}}}const w=t=>t[(t=>Math.floor(Math.random()*t))(t.length)],p=(t,e,i=[])=>({w:t,h:e,data:i}),y=(t,e,i)=>n(r(i,t.w),h(e.tw,e.th)),x=(t,e)=>{t.data=new Array(t.w*t.h).fill(e)},A=(t,e,i)=>{t.data[((t,e)=>t.x+t.y*e)(e,t.w)]=i},B=(t,e,i)=>{for(let s in i.data)i.data[s]>0&&A(t,a(e,r(s,i.w)),i.data[s])},v=(t,e)=>{const i=s(t.w*e.tw,t.h*e.th);for(let s in t.data)l(i,e,y(t,e,s),t.data[s]);return i},M={tower:p(9,15,[0,9,13,13,13,13,13,9,0,0,17,11,35,35,35,11,17,0,0,17,1,25,28,27,1,17,0,0,17,1,33,33,33,1,17,0,0,17,1,25,28,27,1,17,0,0,17,1,33,33,33,1,17,0,0,10,13,13,13,13,13,10,0,0,17,11,17,20,17,11,17,0,51,42,17,49,20,49,17,42,52,53,26,20,57,17,57,17,26,53,53,26,17,20,17,20,21,26,53,53,26,20,17,49,20,20,26,53,53,43,20,17,57,20,17,43,53,53,26,20,20,57,17,20,41,53,59,61,61,61,45,61,61,61,60]),inn:p(17,17,[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,1,1,1,1,1,2,1,1,17,19,17,17,17,19,17,1,1,1,1,1,1,1,1,7,1,17,1,46,47,48,1,17,2,1,1,1,1,1,7,1,1,1,17,1,1,1,1,101,17,1,1,1,1,2,1,1,1,17,17,17,17,17,17,17,29,17,1,1,1,17,17,17,17,17,17,1,38,1,56,1,1,58,17,1,7,1,19,1,1,30,39,17,1,1,1,1,1,102,1,17,7,1,7,17,32,1,1,58,29,1,31,31,31,1,1,1,17,2,1,1,17,1,1,37,1,17,1,14,15,16,1,1,1,17,19,17,1,17,17,17,17,17,17,1,31,31,31,1,1,31,22,31,17,1,19,1,1,30,39,17,1,1,1,1,1,1,31,23,31,17,1,17,32,1,1,58,29,1,1,1,1,1,1,31,24,31,17,1,17,1,1,37,1,17,1,1,1,1,1,1,1,1,1,17,2,17,17,17,17,17,17,36,1,1,1,58,1,1,1,36,17,1,1,2,1,1,1,17,17,17,19,17,29,17,19,17,17,17,1,7,1,2,1,1,1,2,1,1,1,50,40,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,50,1,1,1,2,1,1]),graves:p(5,5,[66,1,68,1,65,3,3,3,3,3,65,1,3,1,66,1,1,3,69,1,67,1,3,1,67]),fort:p(4,3,[0,13,0,0,13,18,17,0,17,17,17,44]),house:p(5,3,[0,34,34,34,0,34,21,17,21,34,17,21,29,21,17]),castle:p(9,10,[51,61,61,61,61,61,61,61,52,53,9,13,13,13,13,13,9,53,53,17,11,35,35,35,11,17,53,53,17,1,17,29,17,1,17,53,53,17,1,1,50,1,1,17,53,53,17,1,58,50,1,1,17,53,53,17,1,1,50,58,1,17,53,53,10,13,13,13,13,13,10,53,53,17,11,17,49,17,11,17,53,59,61,61,61,45,61,61,61,60]),castleroom:p(17,15,[17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,26,43,26,26,63,26,26,42,26,26,64,26,26,43,26,17,17,26,1,1,1,1,1,1,1,1,1,1,1,1,1,26,17,17,26,1,37,4,4,62,4,4,4,62,4,4,37,1,26,17,17,26,1,1,1,1,1,1,1,1,1,1,1,4,1,26,17,17,26,1,4,4,4,4,4,4,4,4,4,1,4,1,26,17,17,26,1,4,1,1,1,1,1,1,1,4,1,4,1,26,17,17,26,1,4,1,4,4,4,4,4,1,4,1,4,1,26,17,17,26,1,4,1,4,1,1,1,1,1,4,1,4,1,26,17,17,26,1,4,1,4,4,4,4,4,4,4,1,4,1,26,17,17,26,1,4,1,1,1,1,1,1,1,1,1,4,1,26,17,17,26,1,37,4,4,4,4,4,4,4,4,4,37,1,26,17,17,26,55,1,1,1,1,1,1,1,1,1,1,1,55,26,17,17,17,17,13,17,13,17,13,13,13,17,13,17,13,17,17,17,17,17,17,17,17,17,17,17,29,17,17,17,17,17,17,17,17]),struct1:p(2,1,[17,44]),struct2:p(2,1,[17,55]),struct3:p(2,1,[12,17]),struct4:p(1,1,[12]),struct5:p(1,1,[55]),struct6:p(1,1,[44])},S=[M.struct1,M.struct2,M.struct3,M.struct4,M.struct5,M.struct6],b=t=>t<.5?2*t*t:(4-2*t)*t-1,I=[[["SOUTHERN TOWER OF SPELLS",0],["is known for powerful mages",6],[" ",0],["After years of education",0],["YOUNG MAGE",4],[" ",0],["GOES BACK",2],["to his village"]]],z=33,O=[1,1,1,2,7,7],E=new Array(10).fill(1).concat(2),F=new Array(4).fill(1).concat(new Array(4).fill(2)),j=new Array(2).fill(E).concat(new Array(2).fill(F)).concat([O,O,O]),R=t=>{((t,e)=>{for(let i in t.data)t.data[i]=w(e)})(t,O)},T=(t,e=0)=>{const i=Math.floor(t.w/2);for(let s=e;s<t.h;s++){A(t,h(i,s),50);for(let e=0;e<j.length;e++)A(t,h(i-e-1,s),w(j[e])),A(t,h(i+e+1,s),w(j[e]))}};class H{constructor(t){this.game=t,this.inter=new u(this.game,I),this.initMap(),this.overlay=s(this.map.image.width,this.map.image.height),this.start=h(248,192),this.end=h(248,1192),this.time=0,this.endtime=8,this.distance=this.end.y-this.start.y,this.pos={},this.pos.x=this.start.x,this.pos.y=this.start.y,this.width=528,this.height=528,this.halfWidth=this.width/2,this.halfHeight=this.height/2,this.scale=2,this.player={x:256,y:1264},this.playerTile=c(this.game.tls,97),this.walks=!1}initMap(){this.map=p(z,3*z),x(this.map,1),R(this.map),T(this.map,70);const t=[[12,65,M.tower],[24,63,M.graves],[24,80,M.house],[9,82,w(S)],[7,84,w(S)],[10,83,w(S)],[21,86,w(S)]];for(let e in t)B(this.map,h(t[e][0],t[e][1]),t[e][2]);this.map.image=v(this.map,this.game.tls)}prepare(){}update(t){this.time+=t,this.inter.update(t),this.time<=8&&(this.pos.y=this.start.y+Math.floor(b(this.time/this.endtime)*this.distance)),this.time>=14&&(this.player.y+=20*t),this.time>=20&&this.game.changeStateInn()}render(){const t=this.game.screenA.scale;this.inter.render(),this.game.screenB.ctx.fillStyle="#091431",this.game.screenB.ctx.fillRect(0,0,this.game.screenB.width,this.game.screenB.height);const e=this.inter.canvas.width,i=this.inter.canvas.height,s=e*t,h=i*t,a=(this.game.screenB.width-s)/2,n=(this.game.screenB.height-h)/2;this.game.screenB.ctx.drawImage(this.inter.canvas,0,0,e,i,a,n,s,h);const r=this.pos.x-this.halfWidth,c=this.pos.y-this.halfHeight,l=this.width,o=this.height,m=l*t,g=o*t,d=(this.game.screenA.width-m)/2,f=(this.game.screenA.height-g)/2;this.game.screenA.ctx.drawImage(this.map.image,r,c,l,o,d,f,m,g),this.overlay.ctx.clearRect(0,0,this.map.image.width,this.map.image.height),this.overlay.ctx.drawImage(this.game.tls.img,this.playerTile.x,this.playerTile.y,this.game.tls.tw,this.game.tls.th,Math.floor(this.player.x),Math.floor(this.player.y),this.game.tls.tw,this.game.tls.th),this.game.screenA.ctx.drawImage(this.overlay,r,c,l,o,d,f,m,g),this.game.render()}}class P{constructor(t){this.game=t,this.map=p(33,33),x(this.map,1),B(this.map,h(8,8),M.inn),this.map.image=v(this.map,this.game.tls),this.pos={x:256,y:272},this.width=528,this.height=528,this.halfWidth=this.width/2,this.halfHeight=this.height/2,console.log("inn")}prepare(){}update(t){}render(){const t=this.game.screenA.scale;this.game.screenB.ctx.fillStyle="#091431",this.game.screenB.ctx.fillRect(0,0,this.game.screenB.width,this.game.screenB.height);const e=this.pos.x-this.halfWidth,i=this.pos.y-this.halfHeight,s=this.width,h=this.height,a=s*t,n=h*t,r=(this.game.screenA.width-a)/2,c=(this.game.screenA.height-n)/2;this.game.screenA.ctx.drawImage(this.map.image,e,i,s,h,r,c,a,n),this.game.render()}}let W=0;function _(){(W+=1)>=2&&(C.state=new H(C),C.loop=new g(C.state),C.loop.start())}const C={};C.imgFont=new Image,C.fnt=new class{constructor(t,e,i,s){this.image=t,this.size=e,this.columns=i,this.start=s}text(t,e,i,s){let h=e,a=i;for(let e in s){const i=s.charCodeAt(e)-this.start,n=i%this.columns*this.size,r=Math.floor(i/this.columns)*this.size;t.drawImage(this.image,n,r,this.size,this.size,h,a,this.size,this.size),h+=this.size}}}(C.imgFont,8,16,48),C.imgFont.onload=_,C.imgFont.src="./img/font.png",C.img=new Image,C.tls=((t,e,i,s)=>({img:t,tw:e,th:i,cols:s}))(C.img,16,16,8),C.img.onload=_,C.img.src="./img/tileset.png";const G=528,L=528;function k(t,e){const i=Math.ceil(t.width/e.width),s=Math.ceil(t.height/e.height);return Math.min(i,s)}function q(){C.screen=s(window.innerWidth,window.innerHeight,"screen"),C.halfs=function(t,e){const i=t<=e,s=i?t:Math.floor(t/2),h=i?Math.floor(e/2):e;return{A:{x:0,y:0,width:s,height:h},B:{x:i?0:t-s,y:i?e-h:0,width:s,height:h}}}(C.screen.width,C.screen.height),C.screenA=s(C.halfs.A.width,C.halfs.A.height),C.screenB=s(C.halfs.B.width,C.halfs.B.height),C.screenA.scale=k(C.halfs.A,{width:G,height:L}),C.screenB.scale=k(C.halfs.B,{width:G,height:L}),C.screenA.ctx.fillStyle="red",C.screenA.ctx.fillRect(0,0,C.halfs.A.width,C.halfs.A.height),C.screenB.ctx.fillStyle="blue",C.screenB.ctx.fillRect(0,0,C.halfs.B.width,C.halfs.B.height)}window.addEventListener("resize",q,!1),q(),C.render=function(){this.screen.ctx.drawImage(this.screenA,this.halfs.A.x,this.halfs.A.y),this.screen.ctx.drawImage(this.screenB,this.halfs.B.x,this.halfs.B.y)},C.changeStateInn=function(){this.state=new P(this),this.loop.setState(this.state)}}]);